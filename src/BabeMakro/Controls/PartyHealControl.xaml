<UserControl x:Class="PixelAutomation.Tool.Overlay.WPF.Controls.PartyHealControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:converters="clr-namespace:PixelAutomation.Tool.Overlay.WPF.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">
    <UserControl.Resources>
        <converters:BoolToStatusConverter x:Key="BoolToStatusConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:InvertBoolConverter x:Key="InvertBoolConverter"/>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header and Controls -->
        <Border Grid.Row="0" Background="#2D2D2D" Padding="10" Margin="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="Party Heal System" 
                          FontSize="16" FontWeight="Bold" Foreground="White" 
                          VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Start" Command="{Binding StartCommand}"
                            IsEnabled="{Binding IsRunning, Converter={StaticResource InvertBoolConverter}}"
                            Background="Green" Foreground="White" Padding="15,5" Margin="0,0,10,0"/>
                    <Button Content="Stop" Command="{Binding StopCommand}"
                            IsEnabled="{Binding IsRunning}"
                            Background="Red" Foreground="White" Padding="15,5" Margin="0,0,10,0"/>
                    <Button Content="Save Config" Command="{Binding SaveConfigurationCommand}"
                            Background="Blue" Foreground="White" Padding="10,5" Margin="0,0,10,0"/>
                    <Button Content="Load Config" Command="{Binding LoadConfigurationCommand}"
                            Background="Orange" Foreground="White" Padding="10,5"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Global Configuration -->
        <Expander Grid.Row="1" Header="Global Settings" IsExpanded="True" Margin="5">
            <Border Background="#1E1E1E" Padding="10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Row 1 -->
                    <StackPanel Grid.Column="0" Grid.Row="0" Margin="5">
                        <TextBlock Text="Heal Skill Key:" Foreground="White" Margin="0,0,0,2"/>
                        <TextBox Text="{Binding SkillKey}" Width="80" HorizontalAlignment="Left"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Grid.Row="0" Margin="5">
                        <TextBlock Text="Poll Interval (ms):" Foreground="White" Margin="0,0,0,2"/>
                        <TextBox Text="{Binding PollIntervalMs}" Width="80" HorizontalAlignment="Left"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Grid.Row="0" Margin="5">
                        <TextBlock Text="Animation Delay (ms):" Foreground="White" Margin="0,0,0,2"/>
                        <TextBox Text="{Binding AnimationDelayMs}" Width="80" HorizontalAlignment="Left"/>
                    </StackPanel>

                    <!-- Row 2 -->
                    <StackPanel Grid.Column="0" Grid.Row="1" Margin="5">
                        <TextBlock Text="Color Tolerance:" Foreground="White" Margin="0,0,0,2"/>
                        <TextBox Text="{Binding ColorTolerance}" Width="80" HorizontalAlignment="Left"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Grid.Row="1" Margin="5">
                        <TextBlock Text="Baseline Color (Hex):" Foreground="White" Margin="0,0,0,2"/>
                        <TextBox Text="{Binding BaselineColorHex}" Width="80" HorizontalAlignment="Left"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Grid.Row="1" Margin="5">
                        <TextBlock Text="Min Action Spacing (ms):" Foreground="White" Margin="0,0,0,2"/>
                        <TextBox Text="{Binding MinActionSpacingMs}" Width="80" HorizontalAlignment="Left"/>
                    </StackPanel>

                    <!-- Row 3 -->
                    <StackPanel Grid.Column="0" Grid.Row="2" Margin="5">
                        <TextBlock Text="Humanize Delay Min (ms):" Foreground="White" Margin="0,0,0,2"/>
                        <TextBox Text="{Binding HumanizeDelayMsMin}" Width="80" HorizontalAlignment="Left"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Grid.Row="2" Margin="5">
                        <TextBlock Text="Humanize Delay Max (ms):" Foreground="White" Margin="0,0,0,2"/>
                        <TextBox Text="{Binding HumanizeDelayMsMax}" Width="80" HorizontalAlignment="Left"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Grid.Row="2" Margin="5">
                        <CheckBox Content="Enable Preemption" IsChecked="{Binding PreemptEnabled}" 
                                 Foreground="White" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Expander>

        <!-- Party Members Table -->
        <Border Grid.Row="2" Background="#1E1E1E" Padding="10" Margin="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Party Members" FontSize="14" FontWeight="Bold" 
                          Foreground="White" Margin="0,0,0,10"/>

                <DataGrid Grid.Row="1" ItemsSource="{Binding Members}" 
                         AutoGenerateColumns="False" CanUserAddRows="False" 
                         Background="#2D2D2D" Foreground="White"
                         GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#404040">
                    
                    <DataGrid.Columns>
                        <DataGridCheckBoxColumn Header="Enable" Binding="{Binding Enabled}" Width="60"/>
                        
                        <DataGridTextColumn Header="Member" Binding="{Binding DisplayName}" 
                                           IsReadOnly="True" Width="70"/>
                        
                        <DataGridTextColumn Header="Select Key" Binding="{Binding SelectKey}" Width="80"/>
                        
                        <DataGridTextColumn Header="Threshold %" Binding="{Binding ThresholdPercent}" Width="90"/>
                        
                        <DataGridTextColumn Header="X Start" Binding="{Binding XStart}" Width="70"/>
                        
                        <DataGridTextColumn Header="X Stop" Binding="{Binding XStop}" Width="70"/>
                        
                        <DataGridTextColumn Header="Y" Binding="{Binding Y}" Width="60"/>
                        
                        <DataGridTextColumn Header="Rearm (ms)" Binding="{Binding RearmMs}" Width="80"/>
                        
                        <DataGridTemplateColumn Header="Actions" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Calibrate" Command="{Binding CalibrateCommand}"
                                           Background="#404040" Foreground="White" 
                                           Padding="5,2" Margin="2"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        
                        <DataGridTextColumn Header="Status" Binding="{Binding StatusText}" 
                                           IsReadOnly="True" Width="*"/>
                    </DataGrid.Columns>
                    
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="#2D2D2D"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Enabled}" Value="True">
                                    <Setter Property="Background" Value="#2D4D2D"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#404040" Padding="10" Margin="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="{Binding IsRunning, Converter={StaticResource BoolToStatusConverter}}" 
                          Foreground="{Binding IsRunning, Converter={StaticResource BoolToColorConverter}}"
                          FontWeight="Bold" VerticalAlignment="Center"/>
                
                <TextBlock Grid.Column="1" Text="{Binding StatusMessage}" 
                          Foreground="White" Margin="20,0" VerticalAlignment="Center"/>
                
                <TextBlock Grid.Column="2" 
                          Foreground="Gray" VerticalAlignment="Center">
                    <TextBlock.Text>
                        <Binding Source="{x:Static sys:DateTime.Now}" StringFormat="HH:mm:ss">
                            <Binding.UpdateSourceTrigger>PropertyChanged</Binding.UpdateSourceTrigger>
                        </Binding>
                    </TextBlock.Text>
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</UserControl>